<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Familjeplaneraren</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-purple-50 min-h-screen">
<div id="app" class="p-2 sm:p-4"></div>
<div id="modal"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/date-fns/2.30.0/date-fns.min.js"></script>
<script>
const app={data:{family:[{id:1,name:'Jon',color:'blue'},{id:2,name:'Johanna',color:'purple'},{id:3,name:'LinnÃ©a',color:'pink'},{id:4,name:'Rafael',color:'green'},{id:5,name:'Alicia',color:'orange'}],meals:[],activities:[],future:[],wishes:[],shopping:{food:[],basics:[],big:[]},learning:[]},view:'week',weekOffset:0,init(){try{const s=localStorage.getItem('andersson_v2');if(s)this.data=JSON.parse(s)}catch(e){console.log('No storage')}this.render()},save(){try{localStorage.setItem('andersson_v2',JSON.stringify(this.data))}catch(e){}},getWeek(o){const d=[],t=new Date(),day=t.getDay(),diff=t.getDate()-day+(day===0?-6:1),m=new Date(t.setDate(diff+o*7));for(let i=0;i<7;i++){const dt=new Date(m);dt.setDate(m.getDate()+i);d.push(dt)}return d},fmtDate(d){return d.toISOString().split('T')[0]},dayName(d){return['SÃ¶n','MÃ¥n','Tis','Ons','Tor','Fre','LÃ¶r'][d.getDay()]},parseText(t){const r={personId:null,personName:'',date:null,dayName:'',time:null,title:'',activityType:null,location:null,isChange:false,isCancelled:false,confidence:0};const l=t.toLowerCase();for(const p of this.data.family){if(l.includes(p.name.toLowerCase())){r.personId=p.id;r.personName=p.name;r.confidence+=25;break}}const months={'januari':0,'februari':1,'mars':2,'april':3,'maj':4,'juni':5,'juli':6,'augusti':7,'september':8,'oktober':9,'november':10,'december':11};for(const m in months){if(l.includes(m)){const dm=t.match(/(\d{1,2})\s*(?:januari|februari|mars|april|maj|juni|juli|augusti|september|oktober|november|december)/i);if(dm){const day=parseInt(dm[1]);const ym=t.match(/20\d{2}/);const year=ym?parseInt(ym[0]):new Date().getFullYear();const date=new Date(year,months[m],day);r.date=this.fmtDate(date);r.confidence+=30;break}}}if(!r.date){const days=['mÃ¥ndag','tisdag','onsdag','torsdag','fredag','lÃ¶rdag','sÃ¶ndag'];let di=-1;for(let i=0;i<days.length;i++){if(l.includes(days[i])){di=i;r.dayName=days[i];r.confidence+=20;break}}if(di>=0){const today=new Date();const cd=today.getDay();const td=di+1;let du=td-cd;if(du<=0)du+=7;const tdate=new Date(today);tdate.setDate(today.getDate()+du);r.date=this.fmtDate(tdate)}}const tm=l.match(/(\d{1,2})[:\.,]?(\d{2})?/);if(tm){const h=tm[1].padStart(2,'0');const min=(tm[2]||'00').padStart(2,'0');r.time=h+':'+min;r.confidence+=20}const kw={'basket':'BaskettrÃ¤ning','fotboll':'FotbollstrÃ¤ning','trÃ¤ning':'TrÃ¤ning','match':'Match','gym':'Gym','padel':'Padel','lÃ¶pning':'LÃ¶pning','tandlÃ¤kare':'TandlÃ¤kare','lÃ¤kare':'LÃ¤kare','mÃ¶te':'MÃ¶te','lov':'Lov'};for(const k in kw){if(l.includes(k)){r.activityType=k;r.title=kw[k];r.confidence+=15;break}}r.isChange=l.includes('Ã¤ndrad')||l.includes('flyttad');r.isCancelled=l.includes('instÃ¤lld')||l.includes('avbokad');return r},findDup(p){const e=this.data.activities.find(a=>a.person===p.personId&&a.date===p.date&&a.title.toLowerCase().includes(p.activityType||''));if(e){if(p.time&&e.time!==p.time)return{type:'change',existing:e,newData:p};return{type:'duplicate',existing:e}}return null},showPaste(){document.getElementById('modal').innerHTML='<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4" onclick="app.closeModal()"><div class="bg-white rounded-2xl p-4 sm:p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()"><h3 class="text-xl sm:text-2xl font-bold mb-4">ğŸ“‹ Smart Paste</h3><p class="text-sm text-gray-600 mb-4">Klistra in text frÃ¥n mail, SMS eller kalender</p><textarea id="pi" class="w-full h-32 sm:h-40 p-4 border-2 rounded-xl text-sm" placeholder="Exempel:\nLinnÃ©a baskettrÃ¤ning tisdag 18:00\n\nJon padel 16 januari 2026 kl 19:00\n\nTisdag\n16\nJanuari"></textarea><div class="flex gap-2 mt-4"><button onclick="app.closeModal()" class="flex-1 px-4 py-3 bg-gray-200 rounded-xl font-bold text-sm">Avbryt</button><button onclick="app.processPaste()" class="flex-1 px-4 py-3 bg-blue-600 text-white rounded-xl font-bold text-sm">Analysera â†’</button></div><div id="pr" class="mt-6"></div></div></div>'},processPaste(){const t=document.getElementById('pi').value;if(!t.trim())return;const p=this.parseText(t);const d=this.findDup(p);let h='<div class="space-y-4">';if(d){if(d.type==='duplicate'){h+='<div class="bg-yellow-50 border-2 border-yellow-300 rounded-xl p-4"><div class="font-bold text-yellow-800 mb-2">âš ï¸ Finns redan!</div><div class="text-sm">'+d.existing.title+'<br>'+new Date(d.existing.date).toLocaleDateString('sv-SE',{weekday:'long'})+' '+d.existing.time+'</div><button onclick="app.closeModal()" class="mt-3 px-4 py-2 bg-gray-600 text-white rounded-lg text-sm">OK</button></div>'}else if(d.type==='change'){h+='<div class="bg-orange-50 border-2 border-orange-300 rounded-xl p-4"><div class="font-bold text-orange-800 mb-3">ğŸ”„ Ã„ndring!</div><div class="grid grid-cols-2 gap-3 mb-4 text-sm"><div class="bg-white p-3 rounded"><div class="text-xs text-gray-500">Nuvarande</div><div class="font-bold">'+d.existing.time+'</div></div><div class="bg-green-50 p-3 rounded border-2 border-green-300"><div class="text-xs text-green-700">Ny tid</div><div class="font-bold">'+p.time+'</div></div></div><button onclick="app.updateAct(\''+d.existing.id+'\',\''+p.date+'\',\''+p.time+'\')" class="w-full px-4 py-2 bg-green-600 text-white rounded-lg text-sm">âœ“ Uppdatera</button></div>'}}else if(p.isCancelled){const c=this.data.activities.find(a=>a.person===p.personId&&a.title.toLowerCase().includes(p.activityType||''));if(c){h+='<div class="bg-red-50 border-2 border-red-300 rounded-xl p-4"><div class="font-bold text-red-800 mb-2">âŒ InstÃ¤lld</div><div class="text-sm mb-3">'+c.title+'</div><button onclick="app.del(\'activities\',\''+c.id+'\');app.closeModal();app.render()" class="px-4 py-2 bg-red-600 text-white rounded-lg text-sm">Ta bort</button></div>'}}else{h+='<div class="bg-green-50 border-2 border-green-300 rounded-xl p-4"><div class="font-bold text-green-800 mb-3 flex items-center gap-2"><span>âœ¨ Ny aktivitet!</span><span class="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded">SÃ¤kerhet: '+p.confidence+'%</span></div><div class="space-y-2 mb-4 text-sm"><div><label class="block font-bold mb-1">Person:</label><select id="ep" class="w-full p-2 border-2 rounded-lg">';for(const f of this.data.family){h+='<option value="'+f.id+'"'+(f.id===p.personId?' selected':'')+'>'+f.name+'</option>'}h+='</select></div><div><label class="block font-bold mb-1">Aktivitet:</label><input type="text" id="et" value="'+(p.title||'')+'" class="w-full p-2 border-2 rounded-lg"></div><div><label class="block font-bold mb-1">Datum:</label><input type="date" id="ed" value="'+(p.date||'')+'" class="w-full p-2 border-2 rounded-lg"></div><div><label class="block font-bold mb-1">Tid:</label><input type="time" id="eti" value="'+(p.time||'12:00')+'" class="w-full p-2 border-2 rounded-lg"></div></div><div class="text-xs bg-blue-50 border border-blue-200 p-3 rounded mb-3"><div class="font-bold mb-1">AI tolkade:</div><div class="space-y-1"><div>ğŸ“… '+(p.dayName||'ej')+' â†’ '+(p.date||'ej')+'</div><div>ğŸ• '+(p.time||'ej')+'</div><div>ğŸ‘¤ '+(p.personName||'ej')+'</div></div></div>';window.tempOrig=p;h+='<button onclick="app.confirmParsed()" class="w-full px-4 py-3 bg-green-600 text-white rounded-xl font-bold text-sm">âœ“ LÃ¤gg till</button></div>'}h+='</div>';document.getElementById('pr').innerHTML=h},confirmParsed(){const pid=parseInt(document.getElementById('ep').value);const title=document.getElementById('et').value;const date=document.getElementById('ed').value;const time=document.getElementById('eti').value;if(!date){alert('Datum saknas');return}if(!title){alert('Aktivitet saknas');return}const o=window.tempOrig;if(o){const ch={dateChanged:o.date!==date,timeChanged:o.time!==time,personChanged:o.personId!==pid,titleChanged:o.title!==title};if(ch.dateChanged||ch.timeChanged||ch.personChanged||ch.titleChanged){this.data.learning.push({ts:new Date().toISOString(),orig:o,corr:{pid,title,date,time},ch:ch});if(this.data.learning.length>50)this.data.learning=this.data.learning.slice(-50)}}this.data.activities.push({id:Date.now().toString(),title:title,person:pid,date:date,time:time});this.save();this.closeModal();this.render()},updateAct(id,date,time){const a=this.data.activities.find(x=>x.id===id);if(a){a.date=date;a.time=time;this.save();this.closeModal();this.render()}},closeModal(){document.getElementById('modal').innerHTML=''},del(type,id){if(confirm('Ta bort?')){this.data[type]=this.data[type].filter(x=>x.id!==id);this.save();this.render()}},delShop(type,id){if(confirm('Ta bort?')){this.data.shopping[type]=this.data.shopping[type].filter(x=>x.id!==id);this.save();this.render()}},togShop(type,id){const i=this.data.shopping[type].find(x=>x.id===id);if(i){i.done=!i.done;this.save();this.render()}},addAct(){const t=prompt('Aktivitet:');if(!t)return;const p=parseInt(prompt('Vem? 1=Jon 2=Johanna 3=LinnÃ©a 4=Rafael 5=Alicia'));const d=prompt('Datum (YYYY-MM-DD):');const ti=prompt('Tid:','17:00');this.data.activities.push({id:Date.now().toString(),title:t,person:p,date:d,time:ti});this.save();this.render()},addMeal(){const d=prompt('RÃ¤tt:');if(!d)return;const p=parseInt(prompt('Portioner:','5'));const dt=prompt('Datum (YYYY-MM-DD):');const t=prompt('Tid:','19:00');const i=prompt('Ingredienser (komma):');this.data.meals.push({id:Date.now().toString(),dish:d,portions:p,date:dt,time:t,ings:i});this.save();this.render()},addWish(){const d=prompt('RÃ¤tt:');if(!d)return;const p=parseInt(prompt('Vem? 1-5'));const n=prompt('Note:');this.data.wishes.push({id:Date.now().toString(),dish:d,person:p,note:n,created:new Date().toISOString()});this.save();this.render()},planWish(id){const w=this.data.wishes.find(x=>x.id===id);const d=prompt('Datum?');if(d){this.data.meals.push({id:Date.now().toString(),dish:w.dish,portions:5,date:d,time:'19:00'});this.data.wishes=this.data.wishes.filter(x=>x.id!==id);this.save();this.view='meals';this.render()}},addShop(type){const n=prompt('Vad?');if(!n)return;const a=prompt('MÃ¤ngd:');const b=type==='big'?prompt('Budget:'):null;this.data.shopping[type].push({id:Date.now().toString(),name:n,amount:a,budget:b,done:false});this.save();this.render()},addFuture(){const t=prompt('Vad:');if(!t)return;const d=prompt('Datum:');const ti=prompt('Tid:');const p=prompt('Vem? 1-5:');this.data.future.push({id:Date.now().toString(),title:t,date:d,time:ti,person:p?parseInt(p):null});this.save();this.render()},genShop(){const w=this.getWeek(this.weekOffset);const m=this.data.meals.filter(x=>{const md=new Date(x.date);return md>=w[0]&&md<=w[6]});const ings=new Set();for(const x of m){if(x.ings){x.ings.split(',').forEach(i=>ings.add(i.trim()))}}this.data.shopping.food=Array.from(ings).map(i=>({id:Date.now().toString()+Math.random(),name:i,done:false}));this.save();this.view='shop';this.render()},switchView(v){this.view=v;this.render()},render(){const w=this.getWeek(this.weekOffset);let h='<div class="max-w-6xl mx-auto"><div class="bg-white rounded-xl shadow-lg p-4 mb-4"><div class="flex justify-between items-center mb-3"><div><h1 class="text-lg sm:text-xl font-bold">Familjen Andersson</h1><p class="text-xs sm:text-sm text-gray-600">'+w[0].getDate()+'/'+(w[0].getMonth()+1)+' - '+w[6].getDate()+'/'+(w[6].getMonth()+1)+'</p></div><div class="flex gap-1 sm:gap-2"><button onclick="app.weekOffset--;app.render()" class="px-2 sm:px-3 py-2 bg-gray-200 rounded-lg text-xs">â†</button><button onclick="app.weekOffset=0;app.render()" class="px-2 sm:px-3 py-2 bg-blue-600 text-white rounded-lg text-xs">Idag</button><button onclick="app.weekOffset++;app.render()" class="px-2 sm:px-3 py-2 bg-gray-200 rounded-lg text-xs">â†’</button></div></div><div class="flex flex-wrap gap-1 sm:gap-2 mb-3">';for(const p of this.data.family){h+='<span class="px-2 py-1 bg-'+p.color+'-100 text-'+p.color+'-700 rounded-full text-xs">'+p.name+'</span>'}h+='</div><button onclick="app.showPaste()" class="w-full px-3 py-2 sm:py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-xl font-bold text-xs sm:text-sm">ğŸ“‹ Smart Paste</button></div><div class="bg-white rounded-xl shadow-lg p-2 mb-4 flex gap-1 sm:gap-2 overflow-x-auto">';const tabs=[{id:'week',n:'Vecka',i:'ğŸ“…'},{id:'meals',n:'Mat',i:'ğŸ½ï¸'},{id:'wishes',n:'Ã–nskn',i:'â­',b:this.data.wishes.length},{id:'shop',n:'InkÃ¶p',i:'ğŸ›’'},{id:'future',n:'Framtid',i:'ğŸ“†',b:this.data.future.length}];for(const t of tabs){const a=this.view===t.id;h+='<button onclick="app.switchView(\''+t.id+'\')" class="px-2 sm:px-4 py-2 rounded-lg text-xs whitespace-nowrap flex items-center gap-1 '+(a?'bg-blue-600 text-white':'bg-gray-100')+'"><span>'+t.i+'</span><span class="hidden sm:inline">'+t.n+'</span>'+(t.b?'<span class="bg-red-500 text-white text-xs px-1.5 rounded-full">'+t.b+'</span>':'')+'</button>'}h+='</div>';if(this.view==='week'){h+='<div class="space-y-3">';for(const day of w){const ds=this.fmtDate(day);const meals=this.data.meals.filter(m=>m.date===ds);const acts=this.data.activities.filter(a=>a.date===ds);h+='<div class="bg-white rounded-xl shadow-lg p-3 sm:p-4"><div class="flex justify-between items-center mb-2"><h3 class="font-bold text-sm">'+this.dayName(day)+' '+day.getDate()+'/'+(day.getMonth()+1)+'</h3><button onclick="app.addAct()" class="px-2 py-1 bg-blue-600 text-white rounded text-xs">+</button></div>';for(const m of meals){h+='<div class="bg-orange-50 border border-orange-200 rounded-lg p-2 mb-2 flex justify-between text-xs"><div><div class="font-bold">'+m.dish+'</div><div class="text-xs text-gray-600">'+m.portions+' port</div></div><button onclick="app.del(\'meals\',\''+m.id+'\')" class="text-red-600">âœ•</button></div>'}for(const a of acts){const p=this.data.family.find(f=>f.id===a.person);if(p){h+='<div class="bg-'+p.color+'-50 border border-'+p.color+'-200 rounded-lg p-2 mb-2 flex justify-between text-xs"><div><div class="font-bold">'+a.title+'</div><div class="text-xs text-gray-600">'+a.time+' â€¢ '+p.name+'</div></div><button onclick="app.del(\'activities\',\''+a.id+'\')" class="text-red-600">âœ•</button></div>'}}if(meals.length+acts.length===0){h+='<p class="text-gray-400 text-xs text-center py-4">Inget planerat</p>'}h+='</div>'}h+='</div>'}else if(this.view==='meals'){h+='<div class="bg-white rounded-xl shadow-lg p-4"><div class="flex justify-between mb-4"><h2 class="font-bold">Mat</h2><button onclick="app.addMeal()" class="px-4 py-2 bg-orange-600 text-white rounded-lg text-sm">+ RÃ¤tt</button></div>';if(this.data.meals.length>0){for(const m of this.data.meals){h+='<div class="bg-orange-50 border-2 border-orange-200 rounded-xl p-3 mb-2 flex justify-between text-sm"><div><div class="font-bold">'+m.dish+'</div><div class="text-xs text-gray-600">'+m.portions+' port â€¢ '+m.date+'</div></div><button onclick="app.del(\'meals\',\''+m.id+'\')" class="text-red-600">âœ•</button></div>'}h+='<button onclick="app.genShop()" class="w-full mt-4 bg-green-600 text-white py-3 rounded-xl font-bold text-sm">ğŸ›’ Uppdatera inkÃ¶pslista</button>'}else{h+='<p class="text-gray-400 text-center py-8 text-sm">Ingen mat</p>'}h+='</div>'}else if(this.view==='wishes'){h+='<div class="bg-white rounded-xl shadow-lg p-4"><div class="flex justify-between mb-4"><h2 class="font-bold">Ã–nskningar</h2><button onclick="app.addWish()" class="px-4 py-2 bg-purple-600 text-white rounded-lg text-sm">+ Ã–nska</button></div>';if(this.data.wishes.length>0){for(const w of this.data.wishes){const p=this.data.family.find(f=>f.id===w.person);h+='<div class="bg-purple-50 border-2 border-purple-200 rounded-xl p-3 mb-2 flex justify-between text-sm"><div><span class="px-2 py-1 bg-'+p.color+'-100 text-'+p.color+'-700 rounded text-xs">'+p.name+'</span><div class="font-bold mt-2">'+w.dish+'</div></div><div class="flex gap-2"><button onclick="app.planWish(\''+w.id+'\')" class="px-3 py-1 bg-green-600 text-white rounded text-xs">âœ“</button><button onclick="app.del(\'wishes\',\''+w.id+'\')" class="text-red-600">âœ•</button></div></div>'}}else{h+='<p class="text-gray-400 text-center py-8 text-sm">Inga Ã¶nskningar</p>'}h+='</div>'}else if(this.view==='shop'){const types=[{t:'food',n:'ğŸ›’ Mat',c:'orange'},{t:'basics',n:'ğŸ“¦ Basvaror',c:'blue'},{t:'big',n:'ğŸ‘• SÃ¤llankÃ¶p',c:'purple'}];h+='<div class="space-y-4">';for(const ty of types){h+='<div class="bg-white rounded-xl shadow-lg p-4"><h3 class="font-bold mb-3 text-sm">'+ty.n+'</h3>';if(this.data.shopping[ty.t].length>0){for(const i of this.data.shopping[ty.t]){h+='<div class="flex items-center gap-3 p-2 bg-gray-50 rounded mb-2 text-sm"><input type="checkbox" '+(i.done?'checked':'')+' onchange="app.togShop(\''+ty.t+'\',\''+i.id+'\')" class="w-5 h-5"><div class="flex-1'+(i.done?' line-through text-gray-400':'')+'"><div>'+i.name+'</div>'+(i.amount?'<div class="text-xs text-gray-600">'+i.amount+'</div>':'')+(i.budget?'<div class="text-xs text-purple-600">Max '+i.budget+' kr</div>':'')+'</div><button onclick="app.delShop(\''+ty.t+'\',\''+i.id+'\')" class="text-red-600 text-xs">âœ•</button></div>'}}else{h+='<p class="text-gray-400 text-xs">Tom</p>'}h+='<button onclick="app.addShop(\''+ty.t+'\')" class="w-full mt-3 px-4 py-2 bg-'+ty.c+'-600 text-white rounded-lg text-sm">+ LÃ¤gg till</button></div>'}h+='</div>'}else if(this.view==='future'){h+='<div class="bg-white rounded-xl shadow-lg p-4"><div class="flex justify-between mb-4"><h2 class="font-bold">Framtida</h2><button onclick="app.addFuture()" class="px-4 py-2 bg-green-600 text-white rounded-lg text-sm">+</button></div>';if(this.data.future.length>0){const sorted=[...this.data.future].sort((a,b)=>new Date(a.date)-new Date(b.date));for(const f of sorted){const p=f.person?this.data.family.find(m=>m.id===f.person):null;const days=Math.ceil((new Date(f.date)-new Date())/86400000);h+='<div class="bg-green-50 border-2 border-green-200 rounded-xl p-3 mb-2 flex justify-between text-sm"><div>'+(p?'<span class="px-2 py-1 bg-'+p.color+'-100 text-'+p.color+'-700 rounded text-xs">'+p.name+'</span>':'')+'<div class="font-bold mt-2">'+f.title+'</div><div class="text-xs text-gray-600">'+new Date(f.date).toLocaleDateString('sv-SE',{weekday:'long'})+(days>=0?' â€¢ Om '+days+' dagar':'')+'</div></div><button onclick="app.del(\'future\',\''+f.id+'\')" class="text-red-600">âœ•</button></div>'}}else{h+='<p class="text-gray-400 text-center py-8 text-sm">Inga framtida</p>'}h+='</div>'}h+='</div>';document.getElementById('app').innerHTML=h}};app.init()
</script>
</body>
</html>